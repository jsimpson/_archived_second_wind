%script{:src => "//maps.google.com/maps/api/js?v=3.13&sensor=false&libraries=geometry", :type => "text/javascript"}
%script{:src => "//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js", :type => "text/javascript"}

= javascript_include_tag "//www.google.com/jsapi", "chartkick"

- provide(:title, "#{@activity.type} @ #{@activity.started_at.localtime.to_s(:long)}")

.page-header
  %h1= "#{@activity.type} on #{@activity.started_at.localtime.to_s(:long)}"

#map-container
  #map

:javascript
  $(document).ready(function() {
    gmaps_draw_route(#{@polyline});
  });

.page-header

%table.table.table-striped
  %thead
    %tr
      %th{colspan: 2} Totals
      %th{colspan: 2} Speed
      %th{colspan: 2} Pace
      %th{colspan: 4} Elevation
      %th{colspan: 3} Heart Rate
    %tr
      %th Distance
      %th Time
      %th Avg
      %th Max
      %th Avg
      %th Max
      %th Gain
      %th Loss
      %th Max
      %th Min
      %th Max
      %th Min
      %th Avg
  %tbody
    %tr
      %td= "#{number_with_precision(@activity.get_total_distance, precision: 2)} miles"
      %td= @activity.elapsed_time
      %td= "#{number_with_precision(@activity.get_average_speed, precision: 2)} mph"
      %td= "#{number_with_precision(@activity.get_max_speed, precision: 2)} mph"
      %td= "#{number_with_precision(@activity.get_average_pace, precision: 2)} min/mile"
      %td= "#{number_with_precision(@activity.get_max_pace, precision: 2)} min/mile"
      %td= "#{number_with_precision(@activity.total_elevation_gain, precision: 2)} ft"
      %td= "#{number_with_precision(@activity.total_elevation_loss, precision: 2)} ft"
      %td= "#{number_with_precision(@activity.max_elevation, precision: 2)} ft"
      %td= "#{number_with_precision(@activity.min_elevation, precision: 2)} ft"
      %td= "#{@activity.max_heart_rate} bpm"
      %td= "#{@activity.min_heart_rate} bpm"
      %td= "#{@activity.average_heart_rate} bpm"

.page-header

= area_chart @heart_rate, library: { vAxis: { title: 'Heart Rate (bpm)', titleTextStyle: { fontName: 'Helvetica' }}, colors: ['#990000']}
= area_chart @elevation, library: { vAxis: { title: 'Elevation (ft)', titleTextStyle: { fontName: 'Helvetica' }}, colors: ['#228400']}
= area_chart @pace, library: { vAxis: { title: 'Pace (min/mile)', titleTextStyle: { fontName: 'Helvetica' }}, colors: ['#0077e6']}
